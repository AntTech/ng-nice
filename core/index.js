/*global exports,require,process*/(function () {    "use strict";    var config = require("./../config.js"),        status = require("./status"),        data = require("./data");    /**     * Init     * @param req     * @param res     * @param next     */    exports.init = function (req, res, next) {        res.setHeader('X-Powered-By', 'ng-nice');        var user = req.signedCookies[config.session_key];        if (user) {            data.User.get_by_id(user.id,function(err,user){                if(err || !user){                    res.locals.is_authorized = false;                    next();                    return;                }                res.locals.user = user.makeSimple();                req.user = res.locals.user;                res.locals.is_authorized = true;                next();            });        } else {            res.locals.is_authorized = false;            next();        }    };    /**     * check auth     * @param req     * @param res     * @param next     */    exports.check_auth = function (req, res, next) {        if (res.locals.is_authorized) {            next();        } else {            res.send({code: status.error.permission_deny});        }    };})();